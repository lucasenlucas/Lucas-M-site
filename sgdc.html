<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SGDC ‚Äî Blox‚Äëstyle UI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0e1023; --panel:#171a37; --text:#e8ecff; --muted:#a2a9d6; --brand:#8a7cff; --accent:#f4b73b; --good:#4bd37b; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text)}

    /* Top Navigation */
    .nav-wrap{position:sticky;top:0;z-index:100;background:rgba(16,18,41,.75);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .brand .logo{width:34px;height:34px;display:grid;place-items:center;background:#f4b73b;border-radius:10px;box-shadow:var(--shadow);color:#241a00}

    .menu{display:flex;align-items:center;gap:8px;margin-left:8px}
    .menu a, .menu button{appearance:none;background:transparent;border:1px solid transparent;color:var(--text);text-decoration:none;padding:10px 12px;border-radius:12px;font-weight:600;cursor:pointer}
    .menu a:hover, .menu button:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.08)}

    .spacer{flex:1}
    .balance{font-weight:800;color:var(--good);margin-right:8px;white-space:nowrap}
    .btn{background:#2a2f63;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;border:1px solid rgba(255,255,255,.08)}
    .btn.gold{background:linear-gradient(180deg,#ffd774,#f8b93d);color:#2a1b00;border:none}

    .container{max-width:1200px;margin:0 auto;padding:18px 16px 40px}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:22px;margin-top:16px}
    .game{background:var(--panel);border-radius:20px;overflow:hidden;transition:.2s transform;cursor:pointer;box-shadow:var(--shadow);min-height:220px}
    .game:hover{transform:translateY(-3px)}
    .game .g-thumb{aspect-ratio:16/11;display:grid;place-items:center;font-weight:800}
    .game .g-body{padding:16px;display:flex;align-items:center;justify-content:space-between}
    .pill{background:rgba(255,255,255,.09);padding:6px 10px;border-radius:999px;font-size:.78rem;color:var(--muted)}

    /* Tabs */
    .tabs{margin-top:22px;display:flex;gap:10px}

    /* Modal */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:200}
    .hidden{display:none}
    .modal-card{width:min(92vw,880px);background:var(--panel);border-radius:16px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.08);padding:16px}
    .modal-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .modal-info{display:flex;gap:18px;color:var(--muted);margin:8px 0 12px}
    .modal-actions{display:flex;gap:8px;margin-top:12px}

    /* Toast */
    .toast{position:fixed;right:16px;bottom:16px;background:#1b233f;color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);opacity:0;transform:translateY(10px);transition:.25s ease;z-index:300}
    .toast.show{opacity:1;transform:none}

    /* Snake */
    .snake-canvas{width:100%;height:auto;border-radius:12px;background:#0b0d25;border:1px solid rgba(255,255,255,.06)}

    /* Mines */
    .mines-layout{display:grid;grid-template-columns:320px minmax(260px,1fr);gap:16px;align-items:start}
    .mines-left{display:grid;gap:12px}
    .mines-controls{display:grid;gap:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px}
    .inp{width:100%;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0b0d25;color:var(--text)}
    .chk{display:flex;align-items:center;gap:8px;margin-top:8px}
    .mines-status{display:flex;flex-wrap:wrap;gap:14px;color:var(--muted)}
    .mines-actions{display:flex;gap:8px;align-items:center}
    .mines-statusline{color:var(--muted); margin-left:6px}
    .mines-badges{margin-top:4px}
    .mines-badges ul{margin:8px 0 0 16px;line-height:1.8}
    @media(max-width:800px){ .mines-layout{grid-template-columns:1fr} }

    .mines-board{position:relative;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;overflow:hidden}
    .mines-grid{display:grid;grid-template-columns:repeat(var(--n),1fr);gap:6px;margin-top:6px}
    .mines-cell{position:relative;aspect-ratio:1/1;border-radius:10px;background:#0f1330;border:1px solid rgba(255,255,255,.06);display:grid;place-items:center;font-weight:700;cursor:pointer;transform:translateZ(0);transform-style:preserve-3d;perspective:600px}
    .mines-cell.revealed{background:#1b2258}
    .mines-cell.flip{transition:transform .28s ease; transform:rotateY(180deg)}
    .mines-cell.safe{animation:pop .18s ease}
    .mines-cell.bomb{animation:explode .35s ease both}

    .mines-burst{position:absolute;inset:0;pointer-events:none;opacity:0;background:
      radial-gradient(180px 180px at center, rgba(239,68,68,.24), transparent 60%),
      radial-gradient(400px 400px at center, rgba(239,68,68,.12), transparent 60%);
      transition:opacity .5s ease}
    .mines-burst.show{opacity:1;animation:burstFade .7s ease both}

    .mines-card.badge-blast{animation:screenBlast .6s ease}

    @keyframes pop{0%{transform:scale(.9)}100%{transform:scale(1)}}
    @keyframes explode{0%{box-shadow:0 0 0 rgba(255,0,0,0)}100%{box-shadow:0 0 30px rgba(255,0,0,.6)}}
    @keyframes screenBlast{0%{box-shadow:0 0 0 0 rgba(255,255,255,0)}50%{box-shadow:0 0 120px 40px rgba(255,255,255,.25)}100%{box-shadow:0 0 0 0 rgba(255,255,255,0)}}
    @keyframes burstFade{0%{opacity:0}15%{opacity:1}100%{opacity:0}}
  </style>
</head>
<body>
  <!-- Top Menu -->
  <div class="nav-wrap">
    <nav class="nav">
      <div class="brand"><div class="logo">SG</div><div>SGDC Live</div></div>

      <div class="menu" id="menu">
        <a href="#">Home</a>
        <a href="#">Poker</a>
        <a href="#">Slots</a>
        <a href="#" id="openSnake">Snake</a>
        <a href="#" id="openMines">Mines</a>
        <a href="#" id="openHistory">Geschiedenis</a>
      </div>

      <div class="spacer"></div>
      <div class="balance">Bits: <span id="balance">0</span></div>
      <button class="btn gold">Log in</button>
    </nav>
  </div>

  <!-- Content -->
  <main class="container">
    <section class="grid">
      <article class="game" id="cardSnake">
        <div class="g-thumb" style="background:linear-gradient(160deg,#50e3c2,#8a7cff)">Snake</div>
        <div class="g-body"><strong>Snake</strong><span class="pill">Nu spelen</span></div>
      </article>
      <article class="game" id="cardMines">
        <div class="g-thumb" style="background:linear-gradient(160deg,#ffe36d,#ff9f4d)">Mines</div>
        <div class="g-body"><strong>Mines</strong><span class="pill">Nu spelen</span></div>
      </article>
      <article class="game">
        <div class="g-thumb" style="background:linear-gradient(160deg,#7b6dff,#f453a1)">Plinko</div>
        <div class="g-body"><strong>Plinko</strong><span class="pill">Komt binnenkort</span></div>
      </article>
      <article class="game">
        <div class="g-thumb" style="background:linear-gradient(160deg,#4ad8d0,#7b6dff)">Crash</div>
        <div class="g-body"><strong>Crash</strong><span class="pill">Komt binnenkort</span></div>
      </article>
      <article class="game">
        <div class="g-thumb" style="background:linear-gradient(160deg,#ff5386,#ff8a3d)">Blackjack</div>
        <div class="g-body"><strong>Blackjack</strong><span class="pill">Komt binnenkort</span></div>
      </article>
      <article class="game">
        <div class="g-thumb" style="background:linear-gradient(160deg,#7b6dff,#f453a1)">Roulette</div>
        <div class="g-body"><strong>Roulette</strong><span class="pill">Komt binnenkort</span></div>
      </article>
    </section>

    <div class="tabs">
      <button class="btn" id="tabPlay">Spelen</button>
      <button class="btn" id="tabHistory">Geschiedenis</button>
    </div>
    <section id="historySec" class="hidden" style="margin-top:12px;background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px">
      <h3 style="margin:4px 0 12px">Gamegeschiedenis</h3>
      <div id="historyTable" style="overflow:auto"></div>
    </section>

    <!-- Mines Modal -->
    <div id="minesModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="minesTitle">
      <div class="modal-card mines-card">
        <div class="modal-top">
          <h3 id="minesTitle">Mines ‚Äî tik veilig & cash uit</h3>
          <button class="btn" id="closeMines" type="button">Sluit</button>
        </div>
        <div class="mines-layout">
          <div class="mines-left">
            <div class="mines-controls">
              <label>Inzet (Bits)
                <input type="number" id="minesBet" min="1" value="1" class="inp">
              </label>
              <label>Raster
                <select id="minesSize" class="inp">
                  <option value="5">5√ó5</option>
                  <option value="6">6√ó6</option>
                  <option value="7">7√ó7</option>
                  <option value="8">8√ó8</option>
                </select>
              </label>
              <label>Aantal bommen
                <input type="number" id="minesBombs" min="1" value="5" class="inp">
              </label>
              <label>Seed (optioneel)
                <input type="text" id="minesSeed" placeholder="bv. sgdc-1234" class="inp">
              </label>
              <label class="chk"><input type="checkbox" id="oneDiamond"> One‚ÄëDiamond Mode</label>
            </div>
            <div class="mines-status">
              <div>Bits beschikbaar: <b id="minesBits">0</b></div>
              <div>Veilig aangeklikt: <b id="minesSafe">0</b></div>
              <div>Multiplier: <b id="minesMult">1.00√ó</b></div>
              <div>Mogelijke uitbetaling: <b id="minesPayout">0</b> Bits</div>
            </div>
            <div class="mines-actions">
              <button class="btn gold" id="minesStart" type="button">Start spel</button>
              <button class="btn" id="minesCashout" type="button" disabled>Cash out</button>
              <button class="btn" id="minesReset" type="button">Opnieuw</button>
              <span class="mines-statusline" id="minesStatus"></span>
            </div>
            <details class="mines-badges">
              <summary>Badges</summary>
              <ul id="minesBadges">
                <li data-badge="firstSafe">Eerste veilige klik</li>
                <li data-badge="fiveSafe">5 veilige klikken in √©√©n ronde</li>
                <li data-badge="noBomb">Volledig bord zonder bom</li>
                <li data-badge="oneDiamondWin">Win in One‚ÄëDiamond Mode</li>
              </ul>
            </details>
          </div>
          <div class="mines-right">
            <div class="mines-board">
              <div class="mines-burst" id="minesBurst"></div>
              <div id="minesGrid" class="mines-grid" style="--n:5"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Snake Modal -->
    <div id="snakeModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="snakeTitle">
      <div class="modal-card" style="width:min(92vw,440px)">
        <div class="modal-top">
          <h3 id="snakeTitle">Snake ‚Äî verdien Bits</h3>
          <button class="btn" id="closeSnake" type="button">Sluit</button>
        </div>
        <div class="modal-info">
          <div>Score: <strong id="snakeScore">0</strong></div>
          <div>Verdiend deze sessie: <strong id="snakeEarned">0</strong> Bits</div>
        </div>
        <canvas id="snakeCanvas" width="320" height="320" class="snake-canvas" tabindex="0"></canvas>
        <div class="modal-actions">
          <button class="btn gold" id="snakeStart" type="button">Start spel</button>
          <button class="btn" id="snakePause" type="button">Pauze</button>
          <button class="btn" id="snakeReset" type="button">Opnieuw</button>
        </div>
        <p class="hint" style="color:var(--muted)">Pijltjes of WASD om te sturen. Spatie = start/pauze. Elke üçé = +1 Bit.</p>
      </div>
    </div>
  </main>

  <script>
    'use strict';
    // ---- Bits (persistent) ----
    const STORAGE_KEY = 'sgdc.bits';
    const balanceEl = document.getElementById('balance');
    let balance = Number.parseInt(localStorage.getItem(STORAGE_KEY) ?? '0', 10);
    if (Number.isNaN(balance)) balance = 0;
    function renderBits(){ balanceEl.textContent = balance; }
    function setBits(val){ balance = Math.max(0, Math.floor(Number(val) || 0)); localStorage.setItem(STORAGE_KEY, String(balance)); renderBits(); }
    function addBits(amount){ setBits(balance + Number(amount || 0)); }
    function resetBits(){ localStorage.removeItem(STORAGE_KEY); setBits(0); }
    window.sgdcBits = { get: () => balance, set: setBits, add: addBits, reset: resetBits, key: STORAGE_KEY };
    renderBits();

    // ---- History utils ----
    const HISTORY_KEY = 'sgdc.history';
    function loadHistory(){ try{ return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]'); }catch{ return [] } }
    function saveHistory(arr){ localStorage.setItem(HISTORY_KEY, JSON.stringify(arr)); }
    function pushHistory(entry){ const h = loadHistory(); h.unshift(entry); saveHistory(h); renderHistory(); }
    function renderHistory(){
      const cont = document.getElementById('historyTable'); if(!cont) return;
      const h = loadHistory();
      if(h.length===0){ cont.innerHTML = '<p style="color:var(--muted)">Nog geen spelgeschiedenis.</p>'; return; }
      const rows = h.map(x=>`<tr><td>${new Date(x.ts).toLocaleString()}</td><td>${x.game}</td><td>${x.result}</td><td>${x.bet}</td><td>${x.payout}</td><td>${x.details||''}</td></tr>`).join('');
      cont.innerHTML = `<table style="width:100%;border-collapse:collapse"><thead><tr><th style=\"text-align:left;padding:6px\">Datum</th><th>Spel</th><th>Resultaat</th><th>Inzet</th><th>Payout</th><th>Info</th></tr></thead><tbody>${rows}</tbody></table>`;
      cont.querySelectorAll('th,td').forEach(td=> td.style.padding='6px');
    }
    document.getElementById('tabPlay')?.addEventListener('click', ()=> historySec.classList.add('hidden'));
    document.getElementById('tabHistory')?.addEventListener('click', ()=>{ historySec.classList.remove('hidden'); renderHistory(); });

    // ---- Mines (logic) ----
    const minesModal = document.getElementById('minesModal');
    const minesGrid = document.getElementById('minesGrid');
    const minesBitsEl = document.getElementById('minesBits');
    const minesSafeEl = document.getElementById('minesSafe');
    const minesMultEl = document.getElementById('minesMult');
    const minesPayoutEl = document.getElementById('minesPayout');
    const minesBetInp = document.getElementById('minesBet');
    const minesSizeSel = document.getElementById('minesSize');
    const minesBombsInp = document.getElementById('minesBombs');
    const minesSeedInp = document.getElementById('minesSeed');
    const oneDiamondChk = document.getElementById('oneDiamond');

    let minesState = null;
    function setMinesStatus(msg, err=false){ const el=document.getElementById('minesStatus'); if(!el) return; el.textContent=msg; el.style.color= err? '#ff6b6b' : 'var(--muted)'; }

    // RNG + fair multiplier
    function hashStringToSeed(str){ let h=1779033703^str.length; for(let i=0;i<str.length;i++){ h=Math.imul(h^str.charCodeAt(i),3432918353); h=(h<<13)|(h>>>19); } return (h>>>0)>>>0; }
    function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
    function makeRNG(seedStr){ if(!seedStr) return Math.random; const base = hashStringToSeed(seedStr); return mulberry32(base); }
    function comb(n,k){ if(k<0||k>n) return 0; if(k===0||k===n) return 1; k=Math.min(k,n-k); let num=1,den=1; for(let i=1;i<=k;i++){ num*= (n-(k-i)); den*=i; } return num/den; }
    function probKSafe(N,B,k){ const S=N-B; if(k>S) return 0; return comb(S,k)/comb(N,k); }
    function fairMultiplier(N,B,k){ const p=probKSafe(N,B,k); if(p<=0) return Infinity; return 1/p; }

    function showMines(){ minesModal.classList.remove('hidden'); setupMines(); }
    function hideMines(){ minesModal.classList.add('hidden'); }

    function setupMines(){
      minesBitsEl.textContent = window.sgdcBits.get();
      const n = parseInt(minesSizeSel.value,10);
      minesGrid.style.setProperty('--n', n);
      const seed = (minesSeedInp?.value || '').trim();
      const rng = makeRNG(seed);
      let bombs = parseInt(minesBombsInp.value,10);
      if(oneDiamondChk.checked){ bombs = n*n - 1; }

      minesState = { n, bombs, playing:false, bet: Math.max(1, parseInt(minesBetInp.value,10)||1), safe:0, opened:new Set(), bombsSet: new Set(), mult:1, rng, seed };

      minesGrid.innerHTML = '';
      while(minesState.bombsSet.size < bombs){ minesState.bombsSet.add( Math.floor(rng()*n*n) ); }
      for(let i=0;i<n*n;i++){
        const cell = document.createElement('button');
        cell.className = 'mines-cell'; cell.type='button'; cell.dataset.i = i;
        cell.addEventListener('click', ()=> onMinesCell(i, cell));
        minesGrid.appendChild(cell);
      }
      updateMinesUI();
      document.getElementById('minesCashout').disabled = true;
      setMinesStatus(seed?`Seed actief: ${seed}`:'');
    }

    function startMines(){
      if(!minesState){ setupMines(); }
      const bet = Math.max(1, parseInt(minesBetInp.value,10)||1);
      if(window.sgdcBits.get() < bet){ showToast('Te weinig Bits'); setMinesStatus('Niet genoeg Bits', true); return; }
      window.sgdcBits.set( window.sgdcBits.get() - bet );
      minesState.bet = bet; minesState.playing = true; minesState.safe = 0; minesState.opened.clear(); minesState.mult = 1;
      updateMinesUI(); setMinesStatus('Spel gestart');
    }

    function endMines(win, reason){
      if(!minesState) return;
      if(minesState.playing){
        const pay = win ? Math.round(minesState.bet*minesState.mult) : 0;
        pushHistory({ ts: Date.now(), game:'Mines', result: win? 'win':'lose', bet: minesState.bet, payout: pay, details: reason });
      }
      minesState.playing = false; updateMinesUI();
    }

    function onMinesCell(i, el){
      if(!minesState?.playing) return;
      if(minesState.opened.has(i)) return;
      el.classList.add('flip');
      const isBomb = minesState.bombsSet.has(i);
      if(isBomb){
        el.classList.add('bomb','revealed'); el.textContent='üí•';
        const burst = document.getElementById('minesBurst');
        burst?.classList.remove('show'); void burst?.offsetWidth; burst?.classList.add('show');
        revealAllMines(true);
        document.getElementById('minesCashout').disabled = true;
        document.querySelector('.mines-card')?.classList.add('badge-blast');
        setTimeout(()=> document.querySelector('.mines-card')?.classList.remove('badge-blast'), 600);
        endMines(false, 'Bomb @ '+i);
        return;
      }
      minesState.opened.add(i); minesState.safe++;
      el.classList.add('safe','revealed');
      // Toon altijd diamant i.p.v. cijfers
      // const adj = countAdjMines(i);
      el.textContent = 'üíé';
      updateMinesMultiplier();
      document.getElementById('minesCashout').disabled = false;
      checkBadges();
      updateMinesUI();
      setMinesStatus('Veilig!');
    }

    function cashoutMines(){
      if(!minesState?.playing) return;
      const payout = Math.round(minesState.bet * minesState.mult);
      window.sgdcBits.add(payout);
      showToast('+'+payout+' Bits');
      endMines(true, 'Safe '+minesState.safe);
      revealAllMines(true); document.getElementById('minesCashout').disabled = true; updateMinesUI();
      if(oneDiamondChk.checked && minesState.safe===1){ onDiamondWin(); }
    }

    function revealAllMines(withPing=false){
      const n = minesState.n;
      Array.from(minesGrid.children).forEach((cell,idx)=>{
        cell.classList.add('revealed');
        if(minesState.bombsSet.has(idx)) { cell.textContent = 'üí£'; if(withPing) cell.classList.add('bomb'); }
        else if(!cell.textContent){ cell.textContent = 'üíé'; }
      });
    }

    function countAdjMines(i){
      const n = minesState.n, x = i % n, y = Math.floor(i/n);
      let c=0; for(let dy=-1;dy<=1;dy++){ for(let dx=-1;dx<=1;dx++){ if(dx===0&&dy===0) continue; const nx=x+dx, ny=y+dy; if(nx<0||ny<0||nx>=n||ny>=n) continue; const idx=ny*n+nx; if(minesState.bombsSet.has(idx)) c++; }} return c;
    }

    function updateMinesMultiplier(){
      const N = minesState.n * minesState.n; const B = minesState.bombs; const k = minesState.safe;
      const mult = fairMultiplier(N, B, k);
      minesState.mult = (mult===Infinity? minesState.mult : Number(mult.toFixed(4)));
    }

    function updateMinesUI(){
      minesBitsEl.textContent = window.sgdcBits.get();
      minesSafeEl.textContent = minesState?.safe ?? 0;
      const mult = (minesState?.mult ?? 1);
      minesMultEl.textContent = (mult===Infinity? '‚àû' : mult.toFixed(2)+'√ó');
      const payout = Math.round((minesState?.bet ?? 0) * (mult===Infinity? 0 : mult));
      minesPayoutEl.textContent = payout;
      if(minesState?.playing){
        document.getElementById('minesCashout').disabled = (minesState.safe<=0);
      } else {
        document.getElementById('minesCashout').disabled = true;
      }
    }

    function checkBadges(){
      const card = document.querySelector('.mines-card');
      function award(id, reason){
        const li = document.querySelector(`[data-badge="${id}"]`); if(li && !li.classList.contains('won')){
          li.classList.add('won'); li.innerHTML += ' ‚Äî ‚úÖ';
          card.classList.add('badge-blast'); setTimeout(()=> card.classList.remove('badge-blast'), 600);
          window.sgdcBits.add(5); showToast('+5 Badge: '+reason);
        }
      }
      if(minesState.safe===1) award('firstSafe','Eerste veilige klik');
      if(minesState.safe===5) award('fiveSafe','5 veilig');
      const nTot = minesState.n*minesState.n; const safeTotal = nTot - minesState.bombs;
      if(minesState.safe===safeTotal) award('noBomb','Volledig bord');
    }

    function onDiamondWin(){
      const li = document.querySelector('[data-badge="oneDiamondWin"]');
      if(li && !li.classList.contains('won')){
        li.classList.add('won'); li.innerHTML += ' ‚Äî ‚úÖ';
        document.querySelector('.mines-card')?.classList.add('badge-blast');
        setTimeout(()=> document.querySelector('.mines-card')?.classList.remove('badge-blast'), 600);
        window.sgdcBits.add(5); showToast('+5 Badge: One‚ÄëDiamond Win');
      }
    }

    // ---- Snake ----
    const snakeModal = document.getElementById('snakeModal');
    const cvs = document.getElementById('snakeCanvas');
    const ctx = cvs.getContext('2d');
    const scoreEl = document.getElementById('snakeScore');
    const earnedEl = document.getElementById('snakeEarned');

    const grid = 21; // 21x21
    const cell = Math.floor(cvs.width / grid);
    let loopId = null, dir = {x:1,y:0}, nextDir = {x:1,y:0}, speed = 120;
    let snake, apple, score, earned, paused;

    function rnd(n){ return Math.floor(Math.random()*n); }
    function placeApple(){ let a; do { a = {x:rnd(grid), y:rnd(grid)}; } while (snake.some(s=>s.x===a.x && s.y===a.y)); apple = a; }
    function resetGame(){ snake = [{x:10,y:10}]; dir = {x:1,y:0}; nextDir = {x:1,y:0}; score = 0; earned = 0; paused = true; placeApple(); drawSnake(); updateSnakeUI(); }
    function updateSnakeUI(){ scoreEl.textContent = score; earnedEl.textContent = earned; }

    function drawSnake(){
      ctx.fillStyle = '#0b0d25'; ctx.fillRect(0,0,cvs.width,cvs.height);
      ctx.strokeStyle = 'rgba(255,255,255,.04)'; ctx.beginPath();
      for(let i=0;i<=grid;i++){ ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,grid*cell); ctx.moveTo(0,i*cell); ctx.lineTo(grid*cell,i*cell); }
      ctx.stroke();
      // apple visible
      ctx.fillStyle = '#ff4d4d'; ctx.beginPath(); ctx.arc((apple.x+0.5)*cell,(apple.y+0.5)*cell,cell*0.35,0,Math.PI*2); ctx.fill();
      // snake
      for(let i=0;i<snake.length;i++){
        const s = snake[i]; ctx.fillStyle = i===0 ? '#8a7cff' : '#6476ff'; ctx.fillRect(s.x*cell+1, s.y*cell+1, cell-2, cell-2);
      }
    }

    function stepSnake(){
      if (paused) return;
      dir = nextDir;
      const head = {x: (snake[0].x + dir.x + grid) % grid, y: (snake[0].y + dir.y + grid) % grid};
      if (snake.some((s,i) => i>0 && s.x===head.x && s.y===head.y)) { pauseSnake(); return; }
      snake.unshift(head);
      if (head.x===apple.x && head.y===apple.y){
        score++; earned++; window.sgdcBits.add(1); showToast('+1 Bit'); placeApple();
      } else { snake.pop(); }
      drawSnake(); updateSnakeUI();
    }
    function loopSnake(){ stepSnake(); loopId = setTimeout(loopSnake, speed); }
    function startSnake(){ if(!loopId){ paused=false; cvs.focus(); loopSnake(); } }
    function pauseSnake(){ paused=true; clearTimeout(loopId); loopId=null; }

    window.addEventListener('keydown', e => {
      const k = e.key.toLowerCase();
      if(['arrowup','arrowdown','arrowleft','arrowright',' ','escape','w','a','s','d'].includes(k)) e.preventDefault();
      if(['arrowup','w'].includes(k) && dir.y!==1) nextDir={x:0,y:-1};
      else if(['arrowdown','s'].includes(k) && dir.y!==-1) nextDir={x:0,y:1};
      else if(['arrowleft','a'].includes(k) && dir.x!==1) nextDir={x:-1,y:0};
      else if(['arrowright','d'].includes(k) && dir.x!==-1) nextDir={x:1,y:0};
      else if(k===' '){ paused ? startSnake() : pauseSnake(); }
      else if(k==='escape'){ pauseSnake(); snakeModal.classList.add('hidden'); }
    });

    function showSnake(){
      // zorg dat eventuele oude loop stopt, reset het spel en start meteen
      pauseSnake();
      snakeModal.classList.remove('hidden');
      resetGame();
      setTimeout(()=>{ cvs?.focus(); startSnake(); }, 50);
    }

    // ---- Delegated clicks ----
    document.addEventListener('click', (ev)=>{
      const t = ev.target;
      if(!(t instanceof HTMLElement)) return;
      if(t.id==='openSnake' || t.closest('#cardSnake')){ ev.preventDefault(); showSnake(); }
      if(t.id==='openMines' || t.closest('#cardMines')){ ev.preventDefault(); showMines(); }
      if(t.id==='openHistory'){ ev.preventDefault(); document.getElementById('historySec').classList.remove('hidden'); renderHistory(); }
      if(t.id==='closeSnake'){ ev.preventDefault(); pauseSnake(); snakeModal.classList.add('hidden'); }
      if(t.id==='snakeStart'){ ev.preventDefault(); startSnake(); }
      if(t.id==='snakePause'){ ev.preventDefault(); pauseSnake(); }
      if(t.id==='snakeReset'){ ev.preventDefault(); resetGame(); }
      if(t.id==='minesStart'){ ev.preventDefault(); startMines(); }
      if(t.id==='minesCashout'){ ev.preventDefault(); cashoutMines(); }
      if(t.id==='minesReset'){ ev.preventDefault(); setupMines(); }
      if(t.id==='closeMines'){ ev.preventDefault(); endMines(false,'closed'); hideMines(); }
    });

    // Backdrop close
    minesModal?.addEventListener('click', (e)=>{ if(e.target===minesModal){ endMines(false,'backdrop'); hideMines(); }});
    snakeModal?.addEventListener('click', (e)=>{ if(e.target===snakeModal){ pauseSnake(); snakeModal.classList.add('hidden'); }});

    // Live update mines controls when not playing
    ;['minesBet','minesSize','minesBombs','minesSeed','oneDiamond'].forEach(id=>{
      const el = document.getElementById(id);
      el?.addEventListener('input', ()=>{ if(!minesState?.playing) setupMines(); });
      el?.addEventListener('change', ()=>{ if(!minesState?.playing) setupMines(); });
    });

    // Init
    resetGame();

    // Toast
    function showToast(msg){
      let t = document.querySelector('.toast');
      if(!t){ t = document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
      t.textContent = msg; t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 1200);
    }

    // Dev self-tests (console)
    ;(function(){
      try{
        console.log('[TEST] RNG reproducible? ', (function(){ const r1=makeRNG('seed'); const r2=makeRNG('seed'); return [r1(),r1()].join(',')===[r2(),r2()].join(','); })());
        setupMines();
        console.log('[TEST] Mines init ok? ', !!minesState && minesState.n>0 && minesState.bombsSet.size===minesState.bombs);
      }catch(e){ console.warn('Self-test error', e); }
    })();
  </script>
</body>
</html>
