<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SGDC Live ‚Äî Asset</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#0E1023; --panel:#17193A; --card:#131736; --text:#E9ECFF; --muted:#A3A9D8;
  --good:#4BD37B; --bad:#FF6B6B; --border:#FFFFFF1A; --shadow:0 18px 40px rgba(0,0,0,.45);
  --accent:#8a7cff;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:radial-gradient(1200px 600px at 10% -10%,#14183d 0,#0E1023 60%);color:var(--text)}
.nav{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:10px}
.back{border:1px solid var(--border);background:#ffffff14;padding:8px 12px;border-radius:12px;text-decoration:none;color:var(--text);font-weight:600;transition:.2s}
.back:hover{background:#ffffff28}
.spacer{flex:1}
.balance{font-weight:800;color:var(--good)}
.help{cursor:pointer;font-weight:800;border:1px solid var(--border);background:#ffffff14;padding:8px 12px;border-radius:12px;transition:.2s}
.help:hover{background:#ffffff28}
.container{max-width:1200px;margin:0 auto;padding:18px 16px 60px}
.head{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.title{font-weight:800;font-size:22px}
.ticker{font-size:12px;color:var(--muted)}
.pill{background:#ffffff1a;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px}
.pill.up{color:var(--good);animation:pulseUp 1s} .pill.down{color:var(--bad);animation:pulseDown 1s}
@keyframes pulseUp{0%{background:#4BD37B44}100%{background:#ffffff1a}}
@keyframes pulseDown{0%{background:#FF6B6B44}100%{background:#ffffff1a}}
.stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.chip{border:1px solid #ffffff22;background:#ffffff10;padding:8px 12px;border-radius:12px}
.highlight{outline:2px solid var(--accent);box-shadow:0 0 0 8px #8a7cff22}
.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
@media (max-width:900px){ .grid{grid-template-columns:1fr } }
.card{background:linear-gradient(180deg,var(--card),#101432);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:var(--shadow)}
canvas{width:100%;height:280px;display:block}
.tf{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.btn{padding:8px 12px;border-radius:12px;border:1px solid var(--border);background:#ffffff14;color:var(--text);cursor:pointer;font-weight:700;transition:.2s}
.btn:hover{transform:translateY(-1px)}
.btn.active{background:#ffffff26}
.field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
input[type=number]{background:#0f1330;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.buy{background:linear-gradient(90deg,#37d87c,#2bb56a);border:none}
.sell{background:#ffd66b;border:none;color:#0d0b06}
.swap{background:#9c7cff;border:none}
.small{font-size:12px;color:var(--muted)}
#onboard{position:fixed;inset:0;background:rgba(0,0,0,.82);display:flex;align-items:center;justify-content:center;z-index:9999}
.on-card{background:#15193A;border-radius:20px;padding:24px;max-width:520px;width:90%;color:var(--text);box-shadow:var(--shadow);text-align:center;animation:fadeIn .35s}
.on-card h2{margin:0 0 12px;font-size:22px}
.on-card p{margin:0 0 18px;color:var(--muted)}
.on-buttons{display:flex;justify-content:center;gap:10px}
.on-btn{background:var(--accent);border:none;padding:10px 16px;border-radius:12px;font-weight:700;color:#fff;cursor:pointer;transition:.2s}
.on-btn:hover{transform:scale(1.05)}
.on-btn.alt{background:#444}
@keyframes fadeIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
</style>
</head>
<body>
  <nav class="nav">
    <a class="back" href="./">‚Üê Terug</a>
    <div class="spacer"></div>
    <div class="balance">Bits: <span id="bitsHeader">0</span></div>
    <div class="help" id="helpBtn">?</div>
  </nav>

  <main class="container">
    <div class="head" id="headBlock">
      <div id="icon" class="pill">üì¶</div>
      <div class="title" id="name">Asset</div>
      <div class="ticker" id="ticker">TICK</div>
      <div class="pill" id="dayDelta">+0.00%</div>
      <div class="pill" id="price">‚Çø0.00</div>
    </div>

    <div class="stats" id="statsLine"></div>

    <div class="grid">
      <div class="card" id="chartCard">
        <div id="chartWrap">
          <canvas id="chart" width="1000" height="280"></canvas>
        </div>
        <div class="tf">
          <button class="btn active" data-tf="1h">1h</button>
          <button class="btn" data-tf="1d">1d</button>
          <button class="btn" data-tf="1w">1w</button>
          <button class="btn" data-tf="1m">1m</button>
          <button class="btn" data-tf="all">All</button>
        </div>
      </div>

      <div class="card">
        <div id="buyCard">
          <div class="field">
            <label>Koop ‚Äî bedrag in Bits</label>
            <input type="number" id="buyBits" min="0.01" step="0.01" value="10"/>
            <div class="small">Je koopt <strong><span id="buyQtyPreview">0.00</span></strong> stuks (schatting), fee <span id="feeBuy">0.50%</span>.</div>
            <div class="actions">
              <button class="btn buy" id="btnBuy">Kopen</button>
              <button class="btn swap" id="btnSwap">Swap</button>
            </div>
          </div>
        </div>

        <!-- ‚úÖ Nieuw: Claim sectie -->
        <div id="sellCard" style="margin-top:16px">
          <div class="field">
            <label>Claim ‚Äî bedrag in Bits</label>
            <input id="claimBits" type="number" step="0.01" min="0" placeholder="Bijv. 10">
            <div class="actions" style="margin-top:.5rem">
              <button class="btn sell" id="btnClaim">Claim</button>
            </div>
            <div class="small" id="claimInfo"></div>
            <div class="small">Jouw positie: <span id="posInfo">0.00 stuks @ ‚Çø0.00</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="title" style="font-size:18px">Over deze coin</div>
      <div id="about" class="small" style="margin-top:8px">
        Transactie-markers staan op de grafiek (‚ñ≤ koop, ‚ñº verkoop) met lijnen op tijd en prijs.
      </div>
    </div>
  </main>

  <!-- Onboarding -->
  <div id="onboard" style="display:none">
    <div class="on-card">
      <h2 id="onTitle">Welkom bij Asset</h2>
      <p id="onText">Hier zie je grafiek, positie en kun je handelen.</p>
      <div class="on-buttons">
        <button class="on-btn alt" id="onPrev" style="display:none">Vorige</button>
        <button class="on-btn" id="onNext">Volgende</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   SGDC Asset ‚Äî v2.1 (met Claim Bits)
   ========================= */

// Bits
const STORAGE_KEY='sgdc.bits';
let balance=parseFloat(localStorage.getItem(STORAGE_KEY)??'100');
if(!Number.isFinite(balance)) balance=100;
const bitsEl=document.getElementById('bitsHeader');
function renderBits(){ bitsEl.textContent=(+balance.toFixed(2)); }
function setBits(v){ balance=Math.max(0, Number(v)||0); localStorage.setItem(STORAGE_KEY, String(balance)); renderBits(); }
window.sgdcBits={ get:()=>balance, set:setBits, add:(a)=>setBits(balance+Number(a||0)), reset:()=>{localStorage.removeItem(STORAGE_KEY); setBits(100);} };
renderBits();

// Market data etc. (zelfde als in jouw code) ‚Ä¶
/*  >>> HIER ZOU JE AL JE bestaande Assets, Portfolio, buy(), sell(), chart, onboarding, renderAll(), boot() CODE LATEN STAAN  <<< */

// ‚úÖ Extra Claim logica
const Fee = 0.005;
const $claim = document.getElementById('claimBits');
const $claimInfo = document.getElementById('claimInfo');
function pos(){ return (JSON.parse(localStorage.getItem('portfolio')||'{}'))[sym] || {qty:0,avg:0}; }
function unitsForBits(bits, price){ return bits / (price * (1 - Fee)); }
function bitsForUnits(units, price){ return units * price * (1 - Fee); }
function r(n,d=6){ const p=10**d; return Math.round(n*p)/p; }

$claim.addEventListener('input', ()=>{
  const want = Math.max(0, parseFloat($claim.value||'0'));
  const p = pos(); const price = Assets[sym].price;
  let u = unitsForBits(want, price);
  const capped = u > p.qty;
  if (capped) u = p.qty;

  const willGet = r(bitsForUnits(u, price), 2);
  const feeBits = r(u * price * Fee, 2);
  const left = r(p.qty - u, 6);

  $claimInfo.textContent =
    (want>0)
      ? `We verkopen ~${r(u,6)} stuks ‚áí je ontvangt ¬± ‡∏ø${willGet} (fee ~ ‡∏ø${feeBits}). Positie over: ${left} st.` +
        (capped ? ` Je vroeg meer dan maximaal haalbaar; we claimen het maximum.` : '')
      : '';
});

document.getElementById('btnClaim').addEventListener('click', ()=>{
  const want = Math.max(0, parseFloat($claim.value||'0'));
  if (!want) { alert('Vul een bedrag in Bits in.'); return; }

  const price = Assets[sym].price;
  const uNeed = unitsForBits(want, price);
  const p = pos();
  const uSell = Math.min(uNeed, p.qty);
  const bitsNetto = r(bitsForUnits(uSell, price), 2);

  if (uSell <= 0) { alert('Geen positie om te verkopen.'); return; }

  const res = sell(sym, uSell);
  if (!res.ok) { alert(res.msg); return; }

  $claim.value = '';
  $claimInfo.textContent = `‚úÖ Geclaimd: ‡∏ø${bitsNetto}.`;
  renderAll();
});
</script>
</body>
</html>
